<div id="dashBox" class="card hidden" style="max-width: 550px;">
    <h1>WIND DASHBOARD</h1>
    
    <div class="user-info">
        <div style="text-align: left;">
            <div id="u-name" style="font-size: 20px; font-weight: 800;">USER</div>
            <div id="u-status" style="color: var(--accent); font-size: 12px; font-weight: 600; margin-top: 4px;">Загрузка подписки...</div>
        </div>
        <a href="https://github.com/WindClientFun/windclient/raw/main/launcher.exe" class="download-btn">СКАЧАТЬ</a>
    </div>

    <div id="activation-section" style="margin-bottom: 25px;">
        <div style="display: flex; gap: 10px;">
            <input type="text" id="promo-code" placeholder="Введите ключ активации" style="margin-bottom: 0; padding: 12px 20px;">
            <button class="main-btn" style="width: auto; margin-top: 0; padding: 0 20px;" onclick="activateCode()">ОК</button>
        </div>
    </div>

    <div id="dev-panel" class="hidden" style="background: rgba(192, 132, 252, 0.1); padding: 20px; border-radius: 25px; border: 1px dashed var(--accent); margin-bottom: 25px;">
        <h3 style="font-size: 12px; color: var(--accent); margin-bottom: 15px; letter-spacing: 2px;">DEVELOPER CONSOLE</h3>
        <select id="gen-days" style="width: 100%; background: #000; color: #fff; border: 1px solid var(--border); padding: 10px; border-radius: 10px; margin-bottom: 10px; outline: none;">
            <option value="30">30 Дней</option>
            <option value="180">180 Дней</option>
            <option value="365">365 Дней</option>
            <option value="99999">LIFETIME</option>
        </select>
        <button class="main-btn" style="background: #fff; color: #000;" onclick="generateKey()">СОЗДАТЬ КЛЮЧ</button>
        <div id="last-key" style="margin-top: 10px; font-family: monospace; font-size: 14px; color: var(--gold); cursor: pointer;" title="Нажми, чтобы скопировать"></div>
    </div>

    <div class="shop-grid">
        <div class="shop-item full premium" onclick="buy()">
            <div class="item-name" style="color: var(--gold);">КУПИТЬ КЛЮЧ У БОТА</div>
            <div class="item-cost">Telegram Bot <span>@TetrisWindClientbot</span></div>
        </div>
    </div>
    
    <div class="logout" onclick="location.reload()">ВЫЙТИ ИЗ СИСТЕМЫ</div>
</div>

<script>
    // ... (Твой конфиг Firebase остается тем же) ...
    const config = {
        apiKey: "AIzaSyDy4mU5xpso1OtTA86rbABnwXU6xH_Y5Jk",
        databaseURL: "https://windclient111-default-rtdb.firebaseio.com",
        projectId: "windclient111",
    };
    firebase.initializeApp(config);
    const db = firebase.database();
    let currentUser = null;

    // --- ЛОГИКА АВТОРИЗАЦИИ ---
    async function startAuth() {
        const u = document.getElementById('user').value.trim();
        const p = document.getElementById('pass').value.trim();
        const s = document.getElementById('status');
        if(!u || !p) return;

        try {
            const ref = db.ref('users/' + u);
            const snap = await ref.once('value');
            
            if (mode === 'reg') {
                if (snap.exists()) { s.innerText = 'НИК ЗАНЯТ'; }
                else {
                    await ref.set({ password: p, expiry: 0, role: 'user' });
                    goDash(u, {role: 'user', expiry: 0});
                }
            } else {
                if (snap.exists() && snap.val().password === p) {
                    goDash(u, snap.val());
                } else { s.innerText = 'ОШИБКА ВХОДА'; }
            }
        } catch(e) { s.innerText = e.message; }
    }

    function goDash(name, data) {
        currentUser = name;
        document.getElementById('authBox').classList.add('hidden');
        document.getElementById('dashBox').classList.remove('hidden');
        document.getElementById('dashBox').style.opacity = '1';
        document.getElementById('u-name').innerText = name.toUpperCase();
        
        // Проверка на Developer
        if(name.toLowerCase() === 'developer') {
            document.getElementById('dev-panel').classList.remove('hidden');
            document.getElementById('u-status').innerHTML = "⚡ <span style='color:var(--gold)'>FOREVER + ADMIN</span>";
        } else {
            updateStatusText(data.expiry);
        }
    }

    function updateStatusText(expiry) {
        const st = document.getElementById('u-status');
        if(!expiry || expiry === 0) {
            st.innerText = "НЕТ ПОДПИСКИ";
        } else if (expiry > 50000) {
            st.innerText = "LIFETIME ACCESS";
        } else {
            const date = new Date(expiry).toLocaleDateString();
            st.innerText = "ДО: " + date;
        }
    }

    // --- ГЕНЕРАЦИЯ КЛЮЧЕЙ (ТОЛЬКО ДЛЯ DEV) ---
    async function generateKey() {
        const days = parseInt(document.getElementById('gen-days').value);
        const key = "WIND-" + Math.random().toString(36).substr(2, 9).toUpperCase();
        
        await db.ref('keys/' + key).set(days);
        const display = document.getElementById('last-key');
        display.innerText = "КЛЮЧ: " + key;
        display.onclick = () => {
            navigator.clipboard.writeText(key);
            alert("Скопировано!");
        };
    }

    // --- АКТИВАЦИЯ КЛЮЧА ---
    async function activateCode() {
        const code = document.getElementById('promo-code').value.trim();
        if(!code) return;

        const keyRef = db.ref('keys/' + code);
        const snap = await keyRef.once('value');

        if(snap.exists()) {
            const days = snap.val();
            const userRef = db.ref('users/' + currentUser);
            const userSnap = await userRef.once('value');
            let currentExpiry = userSnap.val().expiry || Date.now();
            
            // Если подписка уже истекла, начинаем отсчет от сегодня
            if (currentExpiry < Date.now()) currentExpiry = Date.now();

            const newExpiry = days > 10000 ? 999999 : currentExpiry + (days * 24 * 60 * 60 * 1000);
            
            await userRef.update({ expiry: newExpiry });
            await keyRef.remove(); // Удаляем ключ после использования
            
            updateStatusText(newExpiry);
            alert("Ключ на " + days + " дн. активирован!");
            document.getElementById('promo-code').value = "";
        } else {
            alert("Неверный или использованный ключ!");
        }
    }
</script>
